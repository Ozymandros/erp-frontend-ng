@if (permissions$ | async; as p) {
<div class="suppliers-list">
  <div class="page-header">
    <h1 nz-typography>Suppliers</h1>
    <div class="header-actions">
      @if (p.canExport) {
        <button type="button" nz-button (click)="exportToXlsx('suppliers.xlsx')" aria-label="Export to Excel">
          <span nz-icon nzType="file-excel"></span> Export XLSX
        </button>
      }
      @if (p.canExport) {
        <button type="button" nz-button (click)="exportToPdf('suppliers.pdf')" aria-label="Export to PDF">
          <span nz-icon nzType="file-pdf"></span> Export PDF
        </button>
      }
      @if (p.canCreate) {
        <button type="button" nz-button nzType="primary" routerLink="/purchasing/suppliers/new" aria-label="Add supplier">
          <span nz-icon nzType="plus"></span>
          Add Supplier
        </button>
      }
    </div>
  </div>

  <div class="list-search">
    <nz-space-compact nzSize="large" class="list-search__compact">
      <nz-input-wrapper>
        <nz-icon nzInputAddonBefore nzType="search" />
        <input
          type="text"
          nz-input
          placeholder="By name or email..."
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearch()"
        />
      </nz-input-wrapper>
    </nz-space-compact>
  </div>

  <nz-table
    #suppliersTable
    [nzData]="suppliers"
    [nzLoading]="loading"
    [nzPageSize]="pageSize"
    [nzPageIndex]="pageIndex"
    [nzTotal]="total"
    [nzFrontPagination]="false"
    (nzPageIndexChange)="onPageChange($event)"
    (nzPageSizeChange)="onPageSizeChange($event)"
    [nzScroll]="{ x: '1000px' }"
  >
    <thead>
      <tr>
        <th id="th-name" scope="col">Name</th>
        <th id="th-email" scope="col">Email</th>
        <th id="th-phone" scope="col">Phone</th>
        <th id="th-address" scope="col">Address</th>
        @if (p.canUpdate || p.canDelete) {
          <th id="th-actions" scope="col" nzWidth="150px">Actions</th>
        }
      </tr>
    </thead>
    <tbody>
      @for (supplier of suppliersTable.data; track supplier.id) {
        <tr>
          <td><strong>{{ supplier.name }}</strong></td>
          <td>{{ supplier.email || '-' }}</td>
          <td>{{ supplier.phone || '-' }}</td>
          <td>{{ supplier.address || '-' }}</td>
          @if (p.canUpdate || p.canDelete) {
            <td>
              <nz-space [nzSize]="8">
                @if (p.canUpdate) {
                  <button
                    *nzSpaceItem
                    type="button"
                    nz-button
                    nzType="link"
                    nz-tooltip
                    nzTooltipTitle="Edit supplier"
                    [routerLink]="['/purchasing/suppliers', supplier.id]"
                  >
                    <span nz-icon nzType="edit"></span>
                  </button>
                }
                @if (p.canDelete) {
                  <button
                    *nzSpaceItem
                    type="button"
                    nz-button
                    nzType="link"
                    nzDanger
                    nz-tooltip
                    nzTooltipTitle="Delete supplier"
                    nz-popconfirm
                    nzPopconfirmTitle="Are you sure delete this supplier?"
                    (nzOnConfirm)="deleteSupplier(supplier)"
                    nzPopconfirmPlacement="left"
                  >
                    <span nz-icon nzType="delete"></span>
                  </button>
                }
              </nz-space>
            </td>
          }
        </tr>
      }
    </tbody>
  </nz-table>
</div>
}
