@if (permissions$ | async; as p) {
<div>
  <div class="page-header">
    <h1>Sales Orders</h1>
    <div class="header-actions">
      @if (p.canExport) {
        <button nz-button (click)="exportToXlsx()">
          <i nz-icon nzType="file-excel"></i> Export XLSX
        </button>
      }
      @if (p.canExport) {
        <button nz-button (click)="exportToPdf()">
          <i nz-icon nzType="file-pdf"></i> Export PDF
        </button>
      }

      @if (p.canCreate) {
        <button nz-button nzType="primary" routerLink="/sales/orders/new">
          <i nz-icon nzType="plus"></i> New Order
        </button>
      }
    </div>
  </div>

  <nz-card>
    <div class="search-container">
      <nz-input-wrapper [nzPrefix]="'search'">
        <input type="text" nz-input placeholder="Search orders..." [(ngModel)]="searchTerm" (ngModelChange)="onSearch()" />
      </nz-input-wrapper>
    </div>

    <nz-table
      #basicTable
      [nzData]="data"
      [nzLoading]="loading"
      [nzTotal]="total"
      [(nzPageIndex)]="pageIndex"
      [(nzPageSize)]="pageSize"
      [nzFrontPagination]="false"
      (nzPageIndexChange)="onPageChange($event)"
      (nzPageSizeChange)="onPageSizeChange($event)"
      [nzScroll]="{ x: '1000px', y: 'calc(100vh - 400px)' }"
    >
      <thead>
        <tr>
          <th>Order #</th>
          <th>Customer</th>
          <th>Date</th>
          <th>Total Amount</th>
          <th>Status</th>
          @if (p.canRead || p.canDelete) {
            <th>Actions</th>
          }
        </tr>
      </thead>
      <tbody>
        @for (data of basicTable.data; track data.id) {
          <tr>
            <td><strong>{{ data.orderNumber }}</strong></td>
            <td>{{ data.customerName }}</td>
            <td>{{ data.orderDate | date:'shortDate' }}</td>
            <td>${{ data.totalAmount.toFixed(2) }}</td>
            <td>
              <nz-tag [nzColor]="getStatusColor(data.status)">
                {{ data.status }}
              </nz-tag>
            </td>
            @if (p.canRead || p.canDelete) {
              <td>
                @if (p.canRead) {
                  <a [routerLink]="['/sales/orders', data.id]" class="view-link">View</a>
                }
                @if (p.canDelete) {
                  <a
                    nz-popconfirm
                    nzPopconfirmTitle="Are you sure cancel this order?"
                    (nzOnConfirm)="deleteOrder(data.id)"
                    nzPopconfirmPlacement="left"
                    class="cancel-link"
                  >Cancel</a>
                }
              </td>
            }
          </tr>
        }
      </tbody>
    </nz-table>
  </nz-card>
</div>
}
