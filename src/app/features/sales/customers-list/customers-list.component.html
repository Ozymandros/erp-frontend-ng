@if (permissions$ | async; as p) {
<div class="customers-list">
  <div class="page-header">
    <h1>Customers Management</h1>
    <div class="header-actions">
      @if (p.canExport) {
        <button nz-button (click)="exportToXlsx('customers.xlsx')">
          <span nz-icon nzType="file-excel"></span> Export XLSX
        </button>
      }
      @if (p.canExport) {
        <button nz-button (click)="exportToPdf('customers.pdf')">
          <span nz-icon nzType="file-pdf"></span> Export PDF
        </button>
      }

      @if (p.canCreate) {
        <button nz-button nzType="primary" routerLink="/sales/customers/new">
          <span nz-icon nzType="plus"></span>
          Add Customer
        </button>
      }
    </div>
  </div>

  <div class="search-bar">
    <input 
      type="text" 
      nz-input 
      placeholder="Search customers..." 
      [(ngModel)]="searchTerm"
      (ngModelChange)="onSearch()"
      [nzSuffixIcon]="'search'"
    />
  </div>

  <nz-table
    #customersTable
    [nzData]="customers"
    [nzLoading]="loading"
    [nzPageSize]="pageSize"
    [nzPageIndex]="pageIndex"
    [nzTotal]="total"
    [nzFrontPagination]="false"
    (nzPageIndexChange)="onPageChange($event)"
    (nzPageSizeChange)="onPageSizeChange($event)"
    [nzScroll]="{ x: '1200px', y: 'calc(100vh - 350px)' }"
  >
    <thead>
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Address</th>
        @if (p.canUpdate || p.canDelete) {
          <th nzWidth="150px">Actions</th>
        }
      </tr>
    </thead>
    <tbody>
      @for (customer of customersTable.data; track customer.id) {
        <tr>
          <td><strong>{{ customer.name }}</strong></td>
          <td>{{ customer.email || '-' }}</td>
          <td>{{ customer.address || '-' }}</td>
          @if (p.canUpdate || p.canDelete) {
            <td>
              @if (p.canUpdate) {
                <button 
                  nz-button 
                  nzType="link" 
                  nzSize="small"
                  [routerLink]="['/sales/customers', customer.id]"
                >
                  <span nz-icon nzType="edit"></span>
                  Edit
                </button>
              }
              @if (p.canDelete) {
                <button 
                  nz-button 
                  nzType="link" 
                  nzSize="small"
                  nzDanger
                  (click)="deleteCustomer(customer)"
                >
                  <span nz-icon nzType="delete"></span>
                  Delete
                </button>
              }
            </td>
          }
        </tr>
      }
    </tbody>
  </nz-table>
</div>
}
