<div class="stock-operations">
  <div class="page-header stock-operations-header">
    <h1>Inventory Operations</h1>
  </div>

  <div nz-row [nzGutter]="16">
    <div nz-col [nzSpan]="12">
      <nz-card nzTitle="Manual Stock Adjustment">
        <form nz-form [formGroup]="adjustmentForm" (ngSubmit)="submitAdjustment()" class="adjustment-form">
          <nz-form-item>
            <nz-form-label [nzSpan]="6" nzRequired>Product</nz-form-label>
            <nz-form-control [nzSpan]="18" nzErrorTip="Please select a product!" class="search-like-control">
              <div #productSelectHost class="select-host">
                <nz-select
                  formControlName="productId"
                  nzSize="large"
                  nzShowSearch
                  nzServerSearch
                  nzPlaceHolder="Type at least 3 characters to search..."
                  [nzOpen]="productDropdownOpen"
                  [nzLoading]="productSearching"
                  [nzNotFoundContent]="notFoundProductText"
                  (nzOnSearch)="onProductSearch($event)"
                  (nzOpenChange)="onProductOpenChange($event)">
                  @for (p of products; track p.id) {
                    <nz-option [nzValue]="p.id" [nzLabel]="p.name + ' (' + p.sku + ')'"></nz-option>
                  }
                </nz-select>
              </div>
            </nz-form-control>
          </nz-form-item>

          <nz-form-item>
            <nz-form-label [nzSpan]="6" nzRequired>Warehouse</nz-form-label>
            <nz-form-control [nzSpan]="18" nzErrorTip="Please select a warehouse!" class="search-like-control">
              <div #warehouseSelectHost class="select-host">
                <nz-select
                  formControlName="warehouseId"
                  nzSize="large"
                  nzShowSearch
                  nzServerSearch
                  nzPlaceHolder="Type at least 3 characters to search..."
                  [nzOpen]="warehouseDropdownOpen"
                  [nzLoading]="warehouseSearching"
                  [nzNotFoundContent]="notFoundWarehouseText"
                  (nzOnSearch)="onWarehouseSearch($event)"
                  (nzOpenChange)="onWarehouseOpenChange($event)">
                  @for (w of warehouses; track w.id) {
                    <nz-option [nzValue]="w.id" [nzLabel]="w.name"></nz-option>
                  }
                </nz-select>
              </div>
            </nz-form-control>
          </nz-form-item>

          <nz-form-item>
            <nz-form-label [nzSpan]="6" nzRequired>Adjustment</nz-form-label>
            <nz-form-control [nzSpan]="18" nzExtra="Use negative numbers for stock removals">
              <nz-input-number formControlName="quantity" nzSize="large" [nzStep]="1" class="full-width-input"></nz-input-number>
            </nz-form-control>
          </nz-form-item>

          <nz-form-item>
            <nz-form-label [nzSpan]="6">Reference/Reason</nz-form-label>
            <nz-form-control [nzSpan]="18" class="search-like-control">
              <input nz-input formControlName="reason" nzSize="large" placeholder="e.g. Damage, Correcting count" />
            </nz-form-control>
          </nz-form-item>

          <nz-form-item>
            <nz-form-control [nzOffset]="6" [nzSpan]="18">
              <button nz-button nzType="primary" type="submit" [nzLoading]="submitting" [disabled]="!adjustmentForm.valid">
                Apply Adjustment
              </button>
            </nz-form-control>
          </nz-form-item>
        </form>
      </nz-card>
    </div>
  </div>
</div>
