@if (permissions$ | async; as p) {
<div class="page-header">
  <h1 nz-typography>Inventory Transactions</h1>
  <div class="header-actions">
    @if (p.canExport) {
      <app-button (click)="exportToXlsx('inventory-transactions.xlsx')" icon="file-excel">
        Export XLSX
      </app-button>
    }
    @if (p.canExport) {
      <app-button (click)="exportToPdf('inventory-transactions.pdf')" icon="file-pdf">
        Export PDF
      </app-button>
    }
  </div>
</div>

<nz-card>
  <div class="search-container">
    <app-input
      [(ngModel)]="searchTerm"
      (ngModelChange)="onSearch()"
      placeholder="Search by SKU or Transaction ID..."
      icon="search"
      size="large"
    ></app-input>
  </div>

  <nz-table
    #basicTable
    [nzData]="data"
    [nzLoading]="loading"
    [nzTotal]="total"
    [(nzPageIndex)]="pageIndex"
    [(nzPageSize)]="pageSize"
    [nzFrontPagination]="false"
    (nzPageIndexChange)="onPageChange($event)"
    (nzPageSizeChange)="onPageSizeChange($event)"
  >
    <thead>
      <tr>
        <th id="th-transaction-id" scope="col">Transaction ID</th>
        <th id="th-date" scope="col">Date</th>
        <th id="th-product-sku" scope="col">Product SKU</th>
        <th id="th-type" scope="col">Type</th>
        <th id="th-quantity" scope="col" nzRight>Quantity</th>
        <th id="th-warehouse" scope="col">Warehouse</th>
        <th id="th-order-reference" scope="col">Order Reference</th>
      </tr>
    </thead>
    <tbody>
      @for (item of basicTable.data; track item.id) {
        <tr>
          <td><span nz-typography nzCopyable [nzCopyText]="item.id" nzCode>{{ item.id | slice:0:8 }}...</span></td>
          <td>{{ item.transactionDate | date:'short' }}</td>
          <td><strong>{{ item.product?.sku || '-' }}</strong></td>
          <td>
            <nz-tag [nzColor]="getTransactionColor(item.transactionType)">
              {{ item.transactionType }}
            </nz-tag>
          </td>
          <td nzRight [class.text-danger]="item.quantityChange < 0" [class.text-success]="item.quantityChange > 0">
            <strong>{{ item.quantityChange > 0 ? '+' : '' }}{{ item.quantityChange }}</strong>
          </td>
          <td>{{ item.warehouse?.name || '-' }}</td>
          <td>
            @if (item.orderId) {
              <a [routerLink]="['/sales/orders', item.orderId]">{{ item.orderId | slice:0:8 }}...</a>
            } @else {
              <span nz-typography nzDisabled>-</span>
            }
          </td>
        </tr>
      }
    </tbody>
  </nz-table>
</nz-card>
}
