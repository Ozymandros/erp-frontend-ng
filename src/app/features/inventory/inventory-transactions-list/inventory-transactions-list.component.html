@if (permissions$ | async; as p) {
<div>
  <div class="page-header">
    <h1 nz-typography>Inventory Transactions</h1>
    <div class="header-actions">
      @if (p.canExport) {
        <button nz-button (click)="exportToXlsx()">
          <i nz-icon nzType="file-excel"></i> Export XLSX
        </button>
      }
      @if (p.canExport) {
        <button nz-button (click)="exportToPdf()">
          <i nz-icon nzType="file-pdf"></i> Export PDF
        </button>
      }
    </div>
  </div>

  <nz-card>
    <div class="list-search">
      <!--<span class="list-search__label">Search</span>-->
      <nz-space-compact nzSize="large" class="list-search__compact">
        <nz-input-wrapper>
          <nz-icon nzInputAddonBefore nzType="search" />
          <input
            type="text"
            nz-input
            placeholder="By reference or notes..."
            [(ngModel)]="searchTerm"
            (ngModelChange)="onSearch()"
          />
        </nz-input-wrapper>
      </nz-space-compact>
    </div>

    <nz-table
      #basicTable
      [nzData]="data"
      [nzLoading]="loading"
      [nzTotal]="total"
      [(nzPageIndex)]="pageIndex"
      [(nzPageSize)]="pageSize"
      [nzFrontPagination]="false"
      (nzPageIndexChange)="onPageChange($event)"
      (nzPageSizeChange)="onPageSizeChange($event)"
      [nzScroll]="{ x: '1000px' }"
    >
      <thead>
        <tr>
          <th id="th-type" scope="col">Type</th>
          <th id="th-product" scope="col">Product</th>
          <th id="th-warehouse" scope="col">Warehouse</th>
          <th id="th-quantity" scope="col">Quantity</th>
          <th id="th-date" scope="col">Date</th>
          <th id="th-doc-reference" scope="col">Doc Reference</th>
          <th id="th-transaction-id" scope="col">Transaction ID</th>
        </tr>
      </thead>
      <tbody>
        @for (item of basicTable.data; track item.id) {
          <tr>
            <td>
              <nz-tag [nzColor]="getTransactionColor(item.transactionType)">
                {{ item.transactionType }}
              </nz-tag>
            </td>
            <td><strong>{{ item.product?.name || item.productId }}</strong></td>
            <td>{{ item.warehouse?.name || item.warehouseId }}</td>
            <td [class.quantity-negative]="item.quantityChange < 0" [class.quantity-positive]="item.quantityChange >= 0">
              {{ (item.quantityChange > 0 ? '+' : '') + item.quantityChange }}
            </td>
            <td>{{ item.transactionDate | date:'short' }}</td>
            <td>
               @if (item.orderId) {
                 <span>
                   <i nz-icon nzType="file-text"></i> {{ item.orderId }}
                 </span>
               } @else {
                 <span class="na-text">N/A</span>
               }
            </td>
            <td><small>{{ item.id }}</small></td>
          </tr>
        }
      </tbody>
    </nz-table>
  </nz-card>
</div>
}
