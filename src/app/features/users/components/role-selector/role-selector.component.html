<div class="role-selector">
  <div class="list-search">
    <app-input
      [(ngModel)]="searchTerm"
      (ngModelChange)="onSearchInput()"
      placeholder="By role name..."
      [disabled]="readonly || loading"
    ></app-input>
  </div>

  @if (!loading) {
    <div class="summary">
      <span>{{ assignedCount }} of {{ totalCount }} roles assigned</span>
    </div>
  }

  <nz-spin [nzSpinning]="loading">
    @if (error) {
      <div class="error-message">
        {{ error }}
      </div>
    }

    @if (!loading) {
      <div class="roles-grid">
      @for (role of filteredRoles; track role.id) {
        <nz-card class="role-card" [class.assigned]="isAssigned(role.id)">
          <div class="role-header">
            <h4>{{ role.name }}</h4>
            @if (isAssigned(role.id)) {
              <span nz-icon nzType="check-circle" nzTheme="fill" class="check-icon"></span>
            }
          </div>
          @if (role.description) {
            <p class="role-description">{{ role.description }}</p>
          }
          <div class="role-actions">
            @if (isAssigned(role.id)) {
              <app-button
                danger
                [loading]="saving"
                [disabled]="readonly"
                (click)="unassignRole(role)"
                class="action-button"
                icon="close"
              >
                Unassign
              </app-button>
            } @else {
              <app-button
                type="primary"
                [loading]="saving"
                [disabled]="readonly"
                (click)="assignRole(role)"
                class="action-button"
                icon="plus"
              >
                Assign
              </app-button>
            }
          </div>
        </nz-card>
      }
      </div>
    }
  </nz-spin>
</div>
