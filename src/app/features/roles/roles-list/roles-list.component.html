<div class="page-header" style="margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center;">
  <h1>Roles Management</h1>
  <div>
    <button nz-button (click)="exportToXlsx()" style="margin-right: 8px;">
      <span nz-icon nzType="file"></span> Export XLSX
    </button>
    <button nz-button (click)="exportToPdf()" style="margin-right: 8px;">
      <span nz-icon nzType="file"></span> Export PDF
    </button>

    <button nz-button nzType="primary" routerLink="/roles/new">
      <i nz-icon nzType="plus"></i> Add Role
    </button>
  </div>
</div>

<nz-card>
  <div style="margin-bottom: 16px; display: flex; gap: 16px;">
    <nz-input-group [nzPrefix]="prefixIconSearch">
      <input type="text" nz-input placeholder="Search roles..." [(ngModel)]="searchTerm" (ngModelChange)="onSearch()" />
    </nz-input-group>
    <ng-template #prefixIconSearch>
      <i nz-icon nzType="search"></i>
    </ng-template>
  </div>

  <nz-table
    #basicTable
    [nzData]="roles"
    [nzLoading]="loading"
    [nzTotal]="total"
    [(nzPageIndex)]="pageIndex"
    [(nzPageSize)]="pageSize"
    [nzFrontPagination]="false"
    (nzPageIndexChange)="loadRoles()"
    (nzPageSizeChange)="loadRoles()"
  >
    <thead>
      <tr>
        <th>Name</th>
        <th>Description</th>
        <th>Permissions</th>
        <th>Created At</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let data of basicTable.data">
        <td><strong>{{ data.name }}</strong></td>
        <td>{{ data.description || '-' }}</td>
        <td>
          <nz-tag *ngFor="let perm of data.permissions | slice:0:3" [nzColor]="'orange'">
            {{ perm.module }}:{{ perm.action }}
          </nz-tag>
          <span *ngIf="data.permissions.length > 3">...</span>
        </td>
        <td>{{ data.createdAt | date:'short' }}</td>
        <td>
          <a [routerLink]="['/roles', data.id]" style="margin-right: 8px;">Edit</a>
          <a
            nz-popconfirm
            nzPopconfirmTitle="Are you sure delete this role?"
            (nzOnConfirm)="deleteRole(data.id)"
            nzPopconfirmPlacement="left"
            style="color: #ff4d4f;"
          >Delete</a>
        </td>
      </tr>
    </tbody>
  </nz-table>
</nz-card>
