<div class="role-detail">
  <div class="page-header">
    <app-button routerLink="/roles" icon="arrow-left" class="back-button">
      Back
    </app-button>
    <h1 nz-typography>{{ isEditMode ? 'Edit Role' : 'Create Role' }}</h1>
  </div>

  <nz-card [nzLoading]="loading">
    <form nz-form [formGroup]="roleForm" (ngSubmit)="save()">
      <nz-form-item>
        <nz-form-label [nzSpan]="4" nzRequired>Role Name</nz-form-label>
        <nz-form-control [nzSpan]="14" nzErrorTip="Please input role name!">
          <app-input formControlName="name" placeholder="e.g. Administrator"></app-input>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSpan]="4">Description</nz-form-label>
        <nz-form-control [nzSpan]="14">
          <app-textarea formControlName="description" placeholder="Role description..." [rows]="3"></app-textarea>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-control [nzOffset]="4" [nzSpan]="14">
          <app-button type="primary" btnType="submit" [loading]="saving" [disabled]="!roleForm.valid">
            {{ isEditMode ? 'Update' : 'Create' }}
          </app-button>
          <app-button type="default" btnType="button" routerLink="/roles" class="cancel-button">Cancel</app-button>
        </nz-form-control>
      </nz-form-item>
    </form>
  </nz-card>

  <!-- Permission Management Card (if canUpdate and in edit mode) -->
  @if (isEditMode && roleId && canUpdate()) {
    <nz-card id="manage-permissions" class="manage-permissions-card">
      <div class="manage-permissions-header">
        <h3 nz-typography class="manage-permissions-title">Manage Permissions</h3>
        <span class="manage-permissions-subtitle">Assign or unassign permissions to this role</span>
      </div>
      <app-permission-selector
        [roleId]="roleId"
        [initialPermissions]="rolePermissions"
        [readonly]="!canUpdate()"
        (permissionsChange)="onPermissionsChange($event)"
      />
    </nz-card>
  }

  <!-- Assigned Permissions View -->
  @if (isEditMode && role) {
    <app-assigned-permissions-view [permissions]="rolePermissions" />
  }
</div>
