<div class="permission-selector">
  <div class="filters-container">
    <input
      nz-input
      [(ngModel)]="searchTerm"
      placeholder="Search permissions..."
      [disabled]="readonly || loading"
      class="search-input"
    />
    <nz-select
      [(ngModel)]="selectedModule"
      [nzPlaceHolder]="'Filter by module'"
      [nzAllowClear]="true"
      [disabled]="readonly || loading"
      class="module-filter"
    >
      <nz-option [nzValue]="null" nzLabel="All Modules"></nz-option>
      @for (module of modules; track module) {
        <nz-option [nzValue]="module" [nzLabel]="module"></nz-option>
      }
    </nz-select>
  </div>

  @if (!loading) {
    <div class="summary">
      <span>{{ assignedCount }} of {{ totalCount }} permissions selected</span>
    </div>
  }

  <nz-spin [nzSpinning]="loading">
    @if (!loading) {
      <div class="modules-container">
      @for (group of groupedPermissions; track group.module) {
        <nz-card class="module-card">
          <div class="module-header">
            <h3>{{ group.module }}</h3>
            <div class="module-actions">
              <button
                nz-button
                nzType="link"
                nzSize="small"
                [nzLoading]="saving"
                [disabled]="readonly"
                (click)="selectAllInModule(group.module)"
              >
                Select All
              </button>
              <button
                nz-button
                nzType="link"
                nzSize="small"
                nzDanger
                [nzLoading]="saving"
                [disabled]="readonly"
                (click)="deselectAllInModule(group.module)"
              >
                Deselect All
              </button>
            </div>
          </div>
          
          <div class="permissions-grid">
            @for (permission of group.permissions; track permission.id) {
              <app-permission-card
                [permission]="permission"
                [isAssigned]="isAssigned(permission.id)"
                [saving]="saving"
                [readonly]="readonly"
                (assign)="assignPermission($event)"
                (unassign)="unassignPermission($event)"
              />
            }
          </div>
        </nz-card>
      }
      </div>
    }
  </nz-spin>
</div>
